<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ZhongKui WAF</title>
    <style>
        body{margin:0;font-family:Arial,sans-serif;background-color:#f6f8fa;display:flex;justify-content:center;align-items:flex-start;height:100vh;padding-top:15vh;box-sizing:border-box}
        .verification-container{background:#ffffff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);width:95%;max-width:520px;min-width:320px;padding:30px;text-align:center;box-sizing:border-box;margin:0 auto}
        .verification-container h1{font-size:24px;color:#333333;margin-bottom:15px}
        .verification-container p{font-size:16px;color:#666666;margin-bottom:20px}
        .progress-bar-container{width:100%;height:10px;background-color:#e9ecef;border-radius:5px;overflow:hidden;margin-bottom:20px}
        .progress-bar{width:0%;height:100%;background-color:#48bb78;transition: width 3s cubic-bezier(0.25, 0.1, 0.25, 1);}
        .debug-info{margin-top:20px;padding:10px;background:#f8f9fa;border-radius:5px;font-size:12px;text-align:left;display:none}
        .debug-toggle{margin-top:10px;padding:5px 10px;background:#007bff;color:white;border:none;border-radius:3px;cursor:pointer;font-size:12px}
        .error-report{margin-top:10px;padding:8px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:5px;font-size:14px;color:#856404}
        .retry-btn{margin-top:10px;padding:8px 16px;background:#28a745;color:white;border:none;border-radius:5px;cursor:pointer}
        .help-info{margin-top:10px;padding:12px;background:#e7f3ff;border:1px solid #bee5eb;border-radius:5px;font-size:14px;color:#0c5460;line-height:1.5;text-align:left}
        .help-info h4{margin:0 0 8px 0;font-size:16px;color:#0c5460;text-align:left}
        .help-info ul{margin:8px 0;padding-left:20px;text-align:left}
        .help-info li{margin:4px 0;text-align:left}
    </style>
</head>

<body>
    <div class="verification-container">
        <h1>å®‰å…¨éªŒè¯</h1>
        <p id="message">æ­£åœ¨è¿›è¡Œæµè§ˆå™¨å®‰å…¨éªŒè¯ï¼Œè¯·ç¨å€™...</p>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <button class="debug-toggle" onclick="toggleDebugInfo()" style="display:none" id="debugToggle">æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</button>
        <div class="debug-info" id="debugInfo"></div>
        <div id="errorReport" style="display:none"></div>
        <div id="helpInfo" style="display:none"></div>
        <button class="retry-btn" onclick="retryVerification()" style="display:none" id="retryBtn">é‡æ–°éªŒè¯</button>
    </div>

    <script>
        var messageElement = document.getElementById('message');
        // è°ƒè¯•æ—¥å¿—æ”¶é›†å™¨
        var debugLogs = [];
        var failureCount = 0;
        var originalConsoleError = console.error;
        var originalConsoleLog = console.log;

        // é‡å†™consoleæ–¹æ³•ä»¥æ”¶é›†æ—¥å¿—
        console.error = function() {
            originalConsoleError.apply(console, arguments);
            debugLogs.push('[ERROR] ' + Array.prototype.join.call(arguments, ' '));
            updateDebugInfo();
        };

        console.log = function() {
            originalConsoleLog.apply(console, arguments);
            debugLogs.push('[LOG] ' + Array.prototype.join.call(arguments, ' '));
            updateDebugInfo();
        };

        // å…¨å±€é”™è¯¯æ•è·
        window.onerror = function(msg, url, line, col, error) {
            var errorMsg = 'è„šæœ¬é”™è¯¯: ' + msg + ' (è¡Œ:' + line + ')';
            debugLogs.push('[JS_ERROR] ' + errorMsg);
            if (error && error.stack) {
                debugLogs.push('[STACK] ' + error.stack);
            }
            updateDebugInfo();
            showErrorReport('JavaScripté”™è¯¯: ' + msg);
            return true;
        };

        function addDebugLog(message) {
            debugLogs.push('[DEBUG] ' + new Date().toLocaleTimeString() + ' - ' + message);
            updateDebugInfo();
        }

        function updateDebugInfo() {
            var debugElement = document.getElementById('debugInfo');
            if (debugElement) {
                debugElement.innerHTML = debugLogs.slice(-20).join('<br>'); // åªæ˜¾ç¤ºæœ€è¿‘20æ¡
            }
        }

        function toggleDebugInfo() {
            var debugElement = document.getElementById('debugInfo');
            if (debugElement.style.display === 'none' || debugElement.style.display === '') {
                debugElement.style.display = 'block';
                updateDebugInfo();
            } else {
                debugElement.style.display = 'none';
            }
        }

        function showErrorReport(message) {
            var errorElement = document.getElementById('errorReport');
            var retryBtn = document.getElementById('retryBtn');
            var debugToggle = document.getElementById('debugToggle');
            var helpElement = document.getElementById('helpInfo');
            var progressBar = document.getElementById('progressBar');
            messageElement.textContent = 'éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•';

            errorElement.innerHTML = '<div class="error-report">' + message + '<br><small>ç‚¹å‡»"<b>æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯</b>"æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</small></div>';
            errorElement.style.display = 'block';
            retryBtn.style.display = 'inline-block';
            debugToggle.style.display = 'inline-block';
            progressBar.style.transition = 'none';

            // æ ¹æ®å½“å‰å¤±è´¥æ¬¡æ•°æ˜¾ç¤ºç›¸åº”çš„å¸®åŠ©ä¿¡æ¯
            var helpContent;
            if (failureCount === 0) {
                // ç¬¬ä¸€æ¬¡å¤±è´¥ï¼šæ˜¾ç¤ºåŸºæœ¬æç¤º
                helpContent = '<div class="help-info">' +
                    '<h4>éªŒè¯é‡åˆ°é—®é¢˜ï¼Ÿè¯·å°è¯•ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š</h4>' +
                    '<ul>' +
                    '<li>ğŸ”§ ç¡®ä¿JavaScriptå·²å¯ç”¨</li>' +
                    '<li>ğŸª ç¡®ä¿Cookieå·²å¯ç”¨</li>' +
                    '<li>ğŸš« è¯·æš‚æ—¶å…³é—­å¹¿å‘Šæ‹¦æˆªæ’ä»¶ï¼ˆå¦‚AdBlockã€uBlockç­‰ï¼‰</li>' +
                    '<li>ğŸŒ æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>' +
                    '</ul>' +
                    '</div>';
            } else {
                // å¤šæ¬¡å¤±è´¥ï¼šæ˜¾ç¤ºè¯¦ç»†å¸®åŠ©ä¿¡æ¯
                helpContent = '<div class="help-info">' +
                    '<h4>å¤šæ¬¡éªŒè¯å¤±è´¥ï¼Œè¯·å°è¯•ä»¥ä¸‹è¯¦ç»†è§£å†³æ–¹æ¡ˆï¼š</h4>' +
                    '<ul>' +
                    '<li>ğŸŒ è¯·ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Edgeã€Safariï¼‰</li>' +
                    '<li>ğŸ”§ ç¡®ä¿JavaScriptå·²å¯ç”¨</li>' +
                    '<li>ğŸª ç¡®ä¿Cookieå·²å¯ç”¨</li>' +
                    '<li>ğŸš« è¯·æš‚æ—¶å…³é—­å¹¿å‘Šæ‹¦æˆªæ’ä»¶ï¼ˆå¦‚AdBlockã€uBlockç­‰ï¼‰</li>' +
                    '<li>ğŸŒ æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>' +
                    '<li>ğŸ”’ å¦‚ä½¿ç”¨ä¼ä¸šç½‘ç»œï¼Œè¯·è”ç³»ç®¡ç†å‘˜æ£€æŸ¥é˜²ç«å¢™è®¾ç½®</li>' +
                    '<li>ğŸ”„ å°è¯•åˆ·æ–°é¡µé¢æˆ–æ¸…é™¤æµè§ˆå™¨ç¼“å­˜</li>' +
                    '<li>ğŸ“± å¦‚ä½¿ç”¨ç§»åŠ¨è®¾å¤‡ï¼Œè¯·å°è¯•åˆ‡æ¢åˆ°æ¡Œé¢æµè§ˆå™¨</li>' +
                    '<li>ğŸ”„ å°è¯•é‡å¯æµè§ˆå™¨æˆ–è®¾å¤‡</li>' +
                    '</ul>' +
                    '<p><strong>å¦‚é—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»ç½‘ç«™ç®¡ç†å‘˜ã€‚</strong></p>' +
                    '</div>';
            }
            helpElement.innerHTML = helpContent;
            helpElement.style.display = 'block';
        }

        function retryVerification() {
            failureCount++;

            document.getElementById('errorReport').style.display = 'none';
            document.getElementById('retryBtn').style.display = 'none';
            document.getElementById('debugToggle').style.display = 'none';
            document.getElementById('debugInfo').style.display = 'none';
            messageElement.textContent = 'æ­£åœ¨è¿›è¡Œæµè§ˆå™¨å®‰å…¨éªŒè¯ï¼Œè¯·ç¨å€™...';
            messageElement.style.color = '#666666';

            runChallenge();
        }

        // æ”¶é›†æµè§ˆå™¨ç¯å¢ƒä¿¡æ¯
        function collectBrowserInfo() {
            var info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages ? navigator.languages.join(',') : 'undefined',
                cookieEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                screenWidth: screen.width,
                screenHeight: screen.height,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight,
                colorDepth: screen.colorDepth,
                pixelDepth: screen.pixelDepth,
                windowWidth: window.innerWidth,
                windowHeight: window.innerHeight,
                hasTouch: 'ontouchstart' in window,
                maxTouchPoints: navigator.maxTouchPoints || 0,
                webdriver: navigator.webdriver,
                plugins: navigator.plugins ? navigator.plugins.length : 0,
                mimeTypes: navigator.mimeTypes ? navigator.mimeTypes.length : 0,
                timestamp: new Date().toISOString()
            };

            addDebugLog('æµè§ˆå™¨ä¿¡æ¯æ”¶é›†å®Œæˆ');
            return info;
        }

        // 1. æ£€æµ‹æ˜¯å¦éœ€è¦ polyfill
        const needsPolyfill = (function() {
            var needs = !window.fetch || typeof Promise === 'undefined' || typeof Object.assign === 'undefined';
            addDebugLog('æ˜¯å¦éœ€è¦polyfill: ' + needs);
            return needs;
        })();

        if (needsPolyfill) {
            addDebugLog('å¼€å§‹åŠ è½½polyfill');
            // 2. åŠ¨æ€åŠ è½½ polyfillï¼ˆé¡ºåºåŠ è½½ï¼šPromise â†’ fetchï¼‰
            loadScript(
                'https://cdn.bootcdn.net/ajax/libs/promise-polyfill/8.3.0/polyfill.min.js',
                function() {
                    addDebugLog('Promise polyfillåŠ è½½æˆåŠŸ');
                    loadScript(
                        'https://cdn.bootcdn.net/ajax/libs/fetch/2.0.4/fetch.min.js',
                        function() {
                            addDebugLog('Fetch polyfillåŠ è½½æˆåŠŸ');
                            runChallenge();  // å…¨éƒ¨åŠ è½½å®Œæˆåæ‰§è¡ŒæŒ‘æˆ˜é€»è¾‘
                        }
                    );
                }
            );
        } else {
            addDebugLog('ç°ä»£æµè§ˆå™¨ï¼Œç›´æ¥æ‰§è¡ŒæŒ‘æˆ˜');
            // 3. ç°ä»£æµè§ˆå™¨ï¼šç›´æ¥æ‰§è¡ŒæŒ‘æˆ˜
            runChallenge();
        }

        // åŠ è½½ script å¹¶å›è°ƒ
        function loadScript(src, callback) {
            addDebugLog('å¼€å§‹åŠ è½½è„šæœ¬: ' + src);
            const script = document.createElement('script');
            script.src = src;
            script.onload = function() {
                addDebugLog('è„šæœ¬åŠ è½½æˆåŠŸ: ' + src);
                callback();
            };
            script.onerror = function() {
                var errorMsg = 'è„šæœ¬åŠ è½½å¤±è´¥: ' + src;
                addDebugLog(errorMsg);
                console.error('Failed to load polyfill:', src);
                showErrorReport('èµ„æºåŠ è½½å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ–å¹¿å‘Šæ‹¦æˆªæ’ä»¶é˜»æ­¢äº†èµ„æºåŠ è½½');
            };
            document.head.appendChild(script);
        }

        var result = $formula;

        function verifyPass() {
            addDebugLog('éªŒè¯é€šè¿‡');
            messageElement.textContent = 'éªŒè¯é€šè¿‡âœ“';
            messageElement.style.color = '#48bb78';
            setTimeout(function () {
                addDebugLog('å‡†å¤‡è·³è½¬é¡µé¢');
                window.location.href = window.location.href;
            }, 1000);
        }

        function verify() {
            addDebugLog('å…¬å¼ï¼š' + '$formula');
            addDebugLog('å¼€å§‹éªŒè¯ï¼Œè®¡ç®—ç»“æœ: ' + result);
            result = result.toString().slice(0, 5);
            addDebugLog('å¤„ç†åçš„ç»“æœ: ' + result);

            var requestBody = 'captcha_result=' + result;
            var requestUrl = '/captcha/challenge?r=' + Math.random();

            addDebugLog('å‘é€éªŒè¯è¯·æ±‚: ' + requestUrl);
            addDebugLog('è¯·æ±‚ä½“: ' + requestBody);

            fetch(requestUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Captcha-Sign': '$captcha-sign',
                    'Captcha-Time': $captcha-time
                },
                credentials: "same-origin",
                body: requestBody
            }).then(function(response) {
                addDebugLog('æ”¶åˆ°å“åº”ï¼ŒçŠ¶æ€ç : ' + response.status);
                if (!response.ok || response.status !== 200) {
                    var errorMsg = 'è¯·æ±‚å‡ºé”™ï¼ŒçŠ¶æ€ç : ' + response.status;
                    addDebugLog(errorMsg);
                    messageElement.textContent = 'è¯·æ±‚å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
                    showErrorReport(errorMsg);
                    throw new Error('HTTP ' + response.status);
                }
                return response.json();
            }).then(function(data) {
                addDebugLog('è§£æå“åº”æ•°æ®: ' + JSON.stringify(data));
                if (data.result == "success") {
                    verifyPass();
                } else {
                    var errorMsg = 'éªŒè¯å¤±è´¥ï¼ŒæœåŠ¡å™¨è¿”å›: ' + JSON.stringify(data);
                    addDebugLog(errorMsg);
                    messageElement.textContent = 'éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•';
                    showErrorReport('æœåŠ¡å™¨éªŒè¯å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç½‘ç»œå»¶è¿Ÿæˆ–å®‰å…¨ç­–ç•¥å¯¼è‡´');
                }
            }).catch(function(err) {
                var errorMsg = 'è¯·æ±‚å¼‚å¸¸: ' + err.message;
                addDebugLog(errorMsg);
                console.error(err);
                messageElement.textContent = 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·é‡è¯•';
                showErrorReport('ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å°è¯•å…³é—­å¹¿å‘Šæ‹¦æˆªæ’ä»¶');
            });
        }

        function isRealBrowser() {
            addDebugLog('å¼€å§‹æµè§ˆå™¨çœŸå®æ€§æ£€æµ‹');

            const nav = window.navigator;
            const doc = document;
            const win = window;

            try {
                // 1. WebDriverå±æ€§æ£€æµ‹ï¼ˆå…¼å®¹æ—§ç‰ˆSeleniumï¼‰
                if (nav.webdriver === true || doc.documentElement.getAttribute('webdriver')) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: WebDriverå±æ€§');
                    return false;
                }

                if (!String.prototype.includes) {
                    String.prototype.includes = function (search) { return this.indexOf(search) !== -1; };
                }

                // 2. ç”¨æˆ·ä»£ç†å…³é”®è¯æ£€æµ‹
                const ua = nav.userAgent.toLowerCase();
                const bannedKeywords = ['headless', 'webdriver', 'puppeteer', 'selenium', 'chromedriver', 'automated', 'phantomjs', 'ghost'];
                var foundKeyword = bannedKeywords.find(function (k) { return ua.includes(k); });
                if (foundKeyword) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: å‘ç°ç¦ç”¨å…³é”®è¯ - ' + foundKeyword);
                    return false;
                }

                // 3. ç§»åŠ¨ç«¯æ£€æµ‹
                const isMobileUA = /(android|webos|iphone|ipad|ipod|blackberry|windows phone|mobile)/i.test(ua);
                const isMobile = isMobileUA;
                addDebugLog('ç§»åŠ¨ç«¯æ£€æµ‹: ' + isMobile);

                // 4. æ’ä»¶å’ŒMimeTypeæ£€æµ‹
                if (!isMobile) {
                    if (!nav.plugins || !nav.mimeTypes) {
                        addDebugLog('æ£€æµ‹å¤±è´¥: ç¼ºå°‘æ’ä»¶æˆ–MimeTypeæ”¯æŒ');
                        return false;
                    }
                    // ç±»å‹æ£€æŸ¥åŠéç©ºéªŒè¯
                    if (!nav.plugins || !nav.mimeTypes || Object.prototype.toString.call(nav.plugins) !== '[object PluginArray]' ||
                        Object.prototype.toString.call(nav.mimeTypes) !== '[object MimeTypeArray]') {
                        addDebugLog('æ£€æµ‹å¤±è´¥: æ’ä»¶æˆ–MimeTypeç±»å‹å¼‚å¸¸');
                        return false;
                    }
                    addDebugLog('æ’ä»¶æ•°é‡: ' + nav.plugins.length + ', MimeTypeæ•°é‡: ' + nav.mimeTypes.length);
                }

                // 5. åŸç”Ÿå‡½æ•°æ£€æµ‹
                const isNative = function (fn) {
                    try {
                        return Function.prototype.toString.call(fn).includes('[native code]');
                    } catch (e) {
                        return false;
                    }
                };
                const nativeChecks = [eval, doc.querySelector, win.setTimeout, win.alert, doc.createElement];
                var failedNative = nativeChecks.find(function (f) { return !isNative(f); });
                if (failedNative) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: éåŸç”Ÿå‡½æ•° - ' + failedNative.name);
                    return false;
                }

                // 6. Headlesså…¨å±€å˜é‡æ£€æµ‹
                const headlessGlobals = ['callPhantom', '_phantom', '__nightmare', '__webdriver', '__driver_evaluate', '__scenario__'];
                var foundGlobal = headlessGlobals.find(function (p) { return p in win; });
                if (foundGlobal) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: å‘ç°headlesså…¨å±€å˜é‡ - ' + foundGlobal);
                    return false;
                }

                // 7. æƒé™APIç‰¹å¾
                if (typeof navigator.permissions !== 'undefined' && typeof navigator.permissions.query === 'function' && /headless/.test(navigator.permissions.query.toString())) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: æƒé™APIåŒ…å«headlessç‰¹å¾');
                    return false;
                }

                // 8. å±å¹•å°ºå¯¸é€»è¾‘ï¼ˆåŠ¨æ€é˜ˆå€¼åŒºåˆ†è®¾å¤‡ç±»å‹ï¼‰
                const minWidth = isMobile ? 200 : 600;
                const minHeight = isMobile ? 300 : 600;
                const availWidth = window.screen.availWidth || window.screen.width;
                const availHeight = window.screen.availHeight || window.screen.height;

                addDebugLog('å±å¹•å°ºå¯¸: ' + availWidth + 'x' + availHeight + ', æœ€å°è¦æ±‚: ' + minWidth + 'x' + minHeight);

                if (availWidth < minWidth || availHeight < minHeight) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: å±å¹•å°ºå¯¸è¿‡å°');
                    return false;
                }

                // 9. è§¦æ‘¸æ”¯æŒæ£€æµ‹ï¼ˆç§»åŠ¨ç«¯ä¸¥æ ¼æ¨¡å¼ï¼‰
                if (isMobile && (!('ontouchstart' in win) || typeof TouchEvent === 'undefined' || nav.maxTouchPoints < 1)) {
                    addDebugLog('æ£€æµ‹å¤±è´¥: ç§»åŠ¨ç«¯ç¼ºå°‘è§¦æ‘¸æ”¯æŒ');
                    return false;
                }

                // 10. è¯­è¨€å±æ€§æ£€æµ‹
                if (typeof nav.languages !== 'undefined' && Array.isArray(nav.languages)) {
                    if (!nav.languages.length || nav.languages.some(function (l) {
                        return !l || typeof l !== 'string';
                    })) {
                        addDebugLog('æ£€æµ‹å¤±è´¥: è¯­è¨€å±æ€§å¼‚å¸¸');
                        return false;
                    }
                }

                // 11. UserAgentDataå“ç‰Œæ£€æµ‹ï¼ˆHeadlessç‰¹å¾ï¼‰
                if (nav.userAgentData && Array.isArray(nav.userAgentData.brands)) {
                    var headlessBrand = nav.userAgentData.brands.find(function (b) {
                        return b.brand && b.brand.toLowerCase().includes('headless');
                    });
                    if (headlessBrand) {
                        addDebugLog('æ£€æµ‹å¤±è´¥: UserAgentDataåŒ…å«headlesså“ç‰Œ');
                        return false;
                    }
                }

                // 12. WebGLæ¸²æŸ“å™¨æ£€æµ‹ï¼ˆè¿‡æ»¤è™šæ‹Ÿæ¸²æŸ“ï¼‰
                const webglCheck = function () {
                    try {
                        const canvas = doc.createElement('canvas');
                        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                        if (!gl) {
                            addDebugLog('WebGLæ£€æµ‹: ä¸æ”¯æŒWebGL');
                            return false;
                        }
                        const ext = gl.getExtension('WEBGL_debug_renderer_info');
                        if (ext) {
                            const renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL).toLowerCase();
                            addDebugLog('WebGLæ¸²æŸ“å™¨: ' + renderer);
                        }
                        return true;
                    } catch (e) {
                        addDebugLog('WebGLæ£€æµ‹å¼‚å¸¸: ' + e.message);
                        return false;
                    }
                };
                if (!webglCheck()) {
                    return false;
                }

                addDebugLog('æµè§ˆå™¨çœŸå®æ€§æ£€æµ‹é€šè¿‡');
            } catch (e) {
                addDebugLog('æ£€æµ‹å¼‚å¸¸: ' + e.message);
                return false;
            }

            return true;
        }

        function runChallenge() {
            addDebugLog('å¼€å§‹æ‰§è¡ŒæŒ‘æˆ˜');

            // æ”¶é›†æµè§ˆå™¨ä¿¡æ¯
            var browserInfo = collectBrowserInfo();
            addDebugLog('æµè§ˆå™¨ç¯å¢ƒä¿¡æ¯å·²æ”¶é›†');

            var progressBar = document.getElementById('progressBar');
            progressBar.style.transition = 'none';
            progressBar.style.width = '0%';
            progressBar.offsetWidth;
            progressBar.style.transition = 'width 3s cubic-bezier(0.25, 0.1, 0.25, 1)';

            setTimeout(function () {
                progressBar.style.width = '100%';
                addDebugLog('è¿›åº¦æ¡åŠ¨ç”»å¼€å§‹');
            }, 10);

            if (isRealBrowser()) {
                addDebugLog('æµè§ˆå™¨éªŒè¯é€šè¿‡ï¼Œ3ç§’åæäº¤éªŒè¯');
                setTimeout(function () {
                    verify();
                }, 3000);
            } else {
                addDebugLog('æµè§ˆå™¨éªŒè¯å¤±è´¥');
                messageElement.textContent = 'æµè§ˆå™¨éªŒè¯å¤±è´¥';
                showErrorReport('æµè§ˆå™¨ç¯å¢ƒæ£€æµ‹æœªé€šè¿‡ï¼Œè¯·ä½¿ç”¨æ­£å¸¸æµè§ˆå™¨è®¿é—®å¹¶ç¡®ä¿JavaScriptå·²å¯ç”¨');
            }
        }
    </script>
</body>

</html>